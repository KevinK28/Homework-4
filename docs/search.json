[
  {
    "objectID": "Homework 4.html",
    "href": "Homework 4.html",
    "title": "ST 558 - Homework 4",
    "section": "",
    "text": "Task 1: Conceptual Questions\n\nWhat is the purpose of the lapply() function? What is the equivalent purrr function?\nThe purpose of the lapply() function is to apply functions to lists. This    function grants us the flexibility and conciseness to obtain the result of another function across multiple elements of a list. THe equivalent purrr function would be the map() function.\nSuppose we have a list called my_list. Each element of the list is a numeric data frame (all columns are numeric). We want use lapply() to run the code cor(numeric_matrix, method = “kendall”) on each element of the list. Write code to do this below! (I’m really trying to ask you how you specify method = “kendall” when calling lapply())\nlapply(X = my_list, FUN = cor, method = \"kendall\")\nWhat are two advantages of using purrr functions instead of the BaseR apply family?\n\nProvides a tidyverse alternative, which gives us more consistency and helper functions.\nThey give us a shorthand way to make anonymous functions\n\nWhat is a side-effect function?\nA side-effect function is one that performs something other than just returning a value. This can include printing output, creating plots, etc.\nWhy can you name a variable sd in a function and not cause any issues with the sd function?\nThis is because we define the variable sd inside of our function, where it will be local to only that function and will shadow that global sd function\n\n\n\nTask 2: Writing R Functions\nIn this task, we will be writing our own R function that outputs the Root Mean Square Error (RMSE) to evaluate predictions. The function will take in a vector of responses and a vector of predictions, and will allow for an additional argument that denotes if we need to remove missing values.\n\ngetRMSE &lt;- function(response, prediction, ...) {\n  if (!is.vector(response) | !is.vector(prediction)) {\n    stop(\"Arguments must be vectors\")\n  }\n  if (length(response) != length(prediction)) {\n    stop(\"Argument vectors must be of equal length\")\n  }\n  \n  squared_diff &lt;- (response - prediction)^2\n  rmse_sq      &lt;- mean(squared_diff, ...)\n  rmse         &lt;- sqrt(rmse_sq)\n  \n  return(paste(\"Root Mean Square Error:\", rmse))\n}\n\nNow that we have created our function, we can test it\n\n#Generate Data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10*x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n#Function Result\nresult &lt;- getRMSE(response = resp, prediction = pred)\nresult\n\n[1] \"Root Mean Square Error: 0.958167655151933\"\n\n#Hard coded result\ntest_diff &lt;- (resp - pred)^2\ntest_rmse_sq      &lt;- mean(test_diff)\ntest_rmse         &lt;- sqrt(test_rmse_sq)\ntest_rmse\n\n[1] 0.9581677\n\n\nNow that we know the functionality of our function is correct, we can then examine the flexibility of the additional argument to work with missing values.\n\n#Assign missing values to two of the values in response vector\nresp[c(4,10)] &lt;- NA_real_\n\n#Test function with, and without specifying missing value argument\ngetRMSE(response = resp, prediction = pred)\n\n[1] \"Root Mean Square Error: NA\"\n\ngetRMSE(response = resp, prediction = pred, na.rm = TRUE)\n\n[1] \"Root Mean Square Error: 0.946594691855753\"\n\n\nThe next function we will write will be to obtain the Mean Absolute Deviation (MAE). This will follow the same specifications (arguments) as the RMSE function.\n\ngetMAE &lt;- function(response, prediction, ...) {\n  \n  if (!is.vector(response) | !is.vector(prediction)) {\n    stop(\"Arguments must be vectors\")\n \n  }\n  if (length(response) != length(prediction)) {\n    stop(\"Argument vectors must be of equal length\")\n  }\n  \n  abs_diff &lt;- abs(response - prediction)\n  MAE &lt;- mean(abs_diff, ...)\n  \n  return(paste(\"Mean Absolute Deviation:\", MAE))\n}\n\nWe have created the function, now let us make sure that it works\n\n#Generate data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10*x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n#Function result\nresult &lt;- getMAE(response = resp, prediction = pred)\nresult\n\n[1] \"Mean Absolute Deviation: 0.815577593682669\"\n\n#Hard coded result\ntest &lt;- mean(abs(resp - pred))\ntest\n\n[1] 0.8155776\n\n\nOnce again, we know that our function works. Now, let us check to see how the inclusion of na values will affect this function.\n\n#Assign missing values to two of the values in response vector\nresp[c(4,10)] &lt;- NA_real_\n\n#Test function with, and without specifying missing value argument\ngetMAE(response = resp, prediction = pred)\n\n[1] \"Mean Absolute Deviation: NA\"\n\ngetMAE(response = resp, prediction = pred, na.rm = TRUE)\n\n[1] \"Mean Absolute Deviation: 0.80941670551392\"\n\n#Make sure it matches hard coded result\ntest_pred &lt;- pred[-c(4,10)]\ntest_resp &lt;- resp[-c(4,10)]\ntest &lt;- mean(abs(test_resp - test_pred))\ntest\n\n[1] 0.8094167\n\n\nThe next goal of this task is to create a wrapper function that has the ability to output both or either of the two metrics above. The function will include the two functions written above, as well as make sure that two numeric vectors have been passed (result in error if not).\n\nmetric_function &lt;- function(response, prediction, metric = \"Both\", ...) {\n  #Make sure it is an atomic, numeric vector\n  if(!is.numeric(response) | !is.numeric(prediction) | !is.atomic(response) |\n     !is.atomic(prediction) | !is.vector(response) | !is.vector(prediction)) {\n    stop(\"Reponse and Prediction arguments must be atomic vectors\")\n    \n  }\n  #Make sure metric argument is correct\n  if (metric != \"Both\" & metric != \"MAE\" & metric != \"RMSE\"){\n    stop(\"Metric argument must be one of these character strings: Both, MAE,\n            or RMSE\")\n  }\n  \n  if (metric == \"Both\"){\n    #Return both metrics if both is specified\n    rmse &lt;- getRMSE(response, prediction, ...)\n    mae  &lt;- getMAE(response, prediction, ...)\n    return(c(rmse, mae))\n  } else if (metric == \"MAE\") {\n    #Return only MAE if MAE is specified\n    mae &lt;- getMAE(response, prediction, ...)\n    return(mae)\n  } else if (metric == \"RMSE\") {\n    #Return only RMSE if RMSE is specified\n    rmse &lt;- getRMSE(response, prediction, ...)\n    return(rmse)\n  }\n  \n}\n\nWe have created our wrapper function, now let us check to see if it works for different specficiations of the metric argument.\n\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10*x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\nmetric_function(resp, pred, metric = \"MAE\")\n\n[1] \"Mean Absolute Deviation: 0.815577593682669\"\n\nmetric_function(resp, pred, metric = \"RMSE\")\n\n[1] \"Root Mean Square Error: 0.958167655151933\"\n\nmetric_function(resp, pred, metric = \"Both\")\n\n[1] \"Root Mean Square Error: 0.958167655151933\" \n[2] \"Mean Absolute Deviation: 0.815577593682669\"\n\n\nWe see that our function indeed works, now let us check it’s functionality when dealing with missing values.\n\n#Assign missing values to two of the values in response vector\nresp[c(4,10)] &lt;- NA_real_\n\nmetric_function(resp, pred, metric = \"MAE\")\n\n[1] \"Mean Absolute Deviation: NA\"\n\nmetric_function(resp, pred, metric = \"RMSE\")\n\n[1] \"Root Mean Square Error: NA\"\n\nmetric_function(resp, pred, metric = \"Both\")\n\n[1] \"Root Mean Square Error: NA\"  \"Mean Absolute Deviation: NA\"\n\nmetric_function(resp, pred, metric = \"MAE\", na.rm = TRUE)\n\n[1] \"Mean Absolute Deviation: 0.80941670551392\"\n\nmetric_function(resp, pred, metric = \"RMSE\", na.rm = TRUE)\n\n[1] \"Root Mean Square Error: 0.946594691855753\"\n\nmetric_function(resp, pred, metric = \"Both\", na.rm = TRUE)\n\n[1] \"Root Mean Square Error: 0.946594691855753\"\n[2] \"Mean Absolute Deviation: 0.80941670551392\"\n\n\nNow that we know it can handle missing data, let us see if the errors are returned if we pass it something other than atomic, numeric vectors.\n\nmetric_function(iris, pred)\n\nError in metric_function(iris, pred): Reponse and Prediction arguments must be atomic vectors\n\n\n\n\nTask 3: Querying an API and a Tidy-Style Function\nIn this task, we will be connecting to the news API and finding information about a topic that I am interested in that has been in the news. We will then take that information, and parse it into a data frame that has the actual article information in it (First column should be a list column). Finally, we will write a function that allows the user to query this API. Inputs of this function should be the title/subject to search for (string), a time period to search from (string), and an API key.\nFirst off, let us find a topic we are interested in and put all articles into a data frame.\n\nURL_news &lt;- \"https://newsapi.org/v2/everything?q=tesla&from=2024-05-25&apiKey=de938e3dab06485f95610e066abe3773\"\n\ndata &lt;- httr::GET(URL_news)\n\nparsed &lt;- fromJSON(rawToChar(data$content))\ndata &lt;- as_tibble(parsed$articles)\ndata\n\n# A tibble: 100 × 8\n   source$id $name author title description url   urlToImage publishedAt content\n   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  \n 1 wired     Wired Aaria… Tesl… Elon Musk … http… https://m… 2024-06-13… \"Under…\n 2 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n 3 &lt;NA&gt;      Yaho… Sarah… Tesl… Tesla is n… http… &lt;NA&gt;       2024-05-31… \"If yo…\n 4 wired     Wired Boone… Thin… Plus: Wils… http… https://m… 2024-06-08… \"Each …\n 5 &lt;NA&gt;      Gizm… Colli… New … The Tesla … http… https://i… 2024-05-28… \"The T…\n 6 business… Busi… Ana A… Tesl… Tesla is a… http… https://i… 2024-06-06… \"Tesla…\n 7 ars-tech… Ars … Jonat… Nvid… The Tesla … http… https://c… 2024-06-04… \"Enlar…\n 8 the-verge The … Andre… The … The 2024 J… http… https://c… 2024-05-30… \"ByAnd…\n 9 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n10 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n# ℹ 90 more rows\n\n\nNow, we can write a function that will allow the user to input their own topic of interest and the farthest date to look from until the present, as well as an API key.\n\nAPI_function &lt;- function(topic, time, apikey){\n  if(!is.character(topic) | !is.character(time) | !is.character(apikey)) {\n    stop(\"Arguments must be a character string\")\n  }\n\n  url &lt;- paste0(\"https://newsapi.org/v2/everything?q=\", topic, \"&from=\", time,\n               \"&apiKey=\", apikey)\n  \n  data &lt;- httr::GET(url)\n  parsed &lt;- fromJSON(rawToChar(data$content))\n  data &lt;- as_tibble(parsed$articles)\n  return(data)\n  \n}\n\nNow, we will run our function twice, to make sure it works.\n\nAPI_function(topic = \"tesla\", time = \"2024-05-25\",\n             apikey = \"de938e3dab06485f95610e066abe3773\")\n\n# A tibble: 100 × 8\n   source$id $name author title description url   urlToImage publishedAt content\n   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  \n 1 wired     Wired Aaria… Tesl… Elon Musk … http… https://m… 2024-06-13… \"Under…\n 2 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n 3 &lt;NA&gt;      Yaho… Sarah… Tesl… Tesla is n… http… &lt;NA&gt;       2024-05-31… \"If yo…\n 4 wired     Wired Boone… Thin… Plus: Wils… http… https://m… 2024-06-08… \"Each …\n 5 &lt;NA&gt;      Gizm… Colli… New … The Tesla … http… https://i… 2024-05-28… \"The T…\n 6 business… Busi… Ana A… Tesl… Tesla is a… http… https://i… 2024-06-06… \"Tesla…\n 7 ars-tech… Ars … Jonat… Nvid… The Tesla … http… https://c… 2024-06-04… \"Enlar…\n 8 the-verge The … Andre… The … The 2024 J… http… https://c… 2024-05-30… \"ByAnd…\n 9 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n10 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n# ℹ 90 more rows\n\nAPI_function(topic = \"apple\", time = \"2024-06-10\",\n             apikey = \"de938e3dab06485f95610e066abe3773\")\n\n# A tibble: 100 × 8\n   source$id $name author title description url   urlToImage publishedAt content\n   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  \n 1 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n 2 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n 3 &lt;NA&gt;      Yaho… Valen… WWDC… Today's ke… http… &lt;NA&gt;       2024-06-10… \"If yo…\n 4 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n 5 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n 6 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n 7 the-verge The … Emma … Tim … In an inte… http… https://c… 2024-06-11… \"Tim C…\n 8 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n 9 &lt;NA&gt;      [Rem… &lt;NA&gt;   [Rem… [Removed]   http… &lt;NA&gt;       1970-01-01… \"[Remo…\n10 wired     Wired Will … Appl… Other tech… http… https://m… 2024-06-13… \"Apple…\n# ℹ 90 more rows"
  }
]